server {
    listen 80;
    server_name your_domain.com www.your_domain.com localhost; # Замените на ваш домен или IP

    # Пути к статике и медиа внутри Nginx контейнера
    # Эти пути должны совпадать с тем, куда мы монтируем соответствующие тома
    set $static_root /usr/share/nginx/html/static;
    set $media_root /usr/share/nginx/html/media;

    # Раздача статических файлов
    location /static/ {
        alias $static_root/;
        expires 1y;
        access_log off;
        add_header Cache-Control "public";
    }

    # Раздача медиафайлов
    location /media/ {
        alias $media_root/;
        expires 1y;
        access_log off;
        add_header Cache-Control "public";
    }

    # Проксирование запросов к Django приложению (пример для /api/)
    # Если все запросы, кроме статики/медиа, идут на Django, используйте основной location / ниже
    location /api/ { 
        proxy_pass http://django:8000; # 'django' - имя сервиса в docker-compose, 8000 - порт Gunicorn
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Проксирование запросов к Node.js API (если нужно и если он не под /api/django)
    # location /nodeapi/ { 
    #     proxy_pass http://node-api:3001; # 'node-api' - имя сервиса, 3001 - порт Node.js API
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # Основной location для проксирования на Django, если Django обрабатывает все остальные пути
    # или если у вас нет отдельного фронтенда, обслуживаемого Nginx.
    # Если /api/ выше обрабатывает все запросы к Django, этот блок можно закомментировать или настроить для фронтенда.
    location / {
        proxy_pass http://django:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    client_max_body_size 20M; # Увеличено для загрузки файлов побольше
}
